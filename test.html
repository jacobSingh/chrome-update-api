<script src="update.chrome.js" type="text/javascript"></script>
<script>

  function AssertException(message) {
    this.message = message;
  }
  
  AssertException.prototype.toString = function () {
    return 'AssertException: ' + this.message;
  }

  function assert(exp, message) {
    if (!exp) {
      throw new AssertException(message);
    }
  }
  
  updateMake = function(version) {
    updates[version] = function(log) {
      log.push(version);
    }
  } 
  
  
  function setup() {
    updates = {};
    updateManager.extensions['abcd'] = {version: 1.0, name: 'foo'};
  }
  
  function teardown() {
    updates = {}
  }

  function test1() {
    updateMake(1.1);
    updateManager.runUpdates(1.0);
    assert(updateManager.log.join(",") == "1.1", "Ran Updates correctly");
    
    updateManager.runUpdates(1.2);
    assert(updateManager.log.join(",") == "", "Ran Updates correctly");
  }
  
  function test2() {
    updateMake(1.1);
    updateMake(1.2);
    updateMake(1.3);
    
    updateManager.runUpdates(1.0);
    assert(updateManager.log.join(",") == "1.1,1.2,1.3", "Ran Updates correctly");
    
    updateManager.runUpdates(1.1);
    assert(updateManager.log.join(",") == "1.2,1.3", "Ran Updates correctly");
  }
  
  function test3() {
    updateMake(1.1);
    updateMake("1.2");
    updateMake("abc");
    
    updateManager.runUpdates(1.0);
    assert(updateManager.log.join(",") == "1.1,1.2", "Ran Updates correctly");
  }

  tests = [test1, test2, test3];
  for (t=0; t < tests.length; t++) {
    setup();
    tests[t]();
    teardown();
  }
  
</script>

